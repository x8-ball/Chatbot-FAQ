<html>
<head>
<title>Chat Room</title>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.8/socket.io.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<link rel="stylesheet" href="/static/sprechblase.css">
</head>

<body>

<script type="text/javascript">
var socket = io.connect('http://127.0.0.1:5000');
var robi = 'bunt';

function sendEvaluation(id, helpful){
	var message = {
		"type" : "rating",
		"id" : id,
		"helpful" : helpful
	};
	socket.send(message);
}
function changeRobi(){
	var image = document.getElementById("robi");
	if(robi.localeCompare('bunt')){
		image.src = "/static/robi.jpg";
		robi = 'weiss';
	}
	else{
		image.src = "/static/robi_bunt.jpg";
		robi = 'bunt';
	}
}
$(document).ready(function() {
	//empfange message und h√§nge diese an messages an
	socket.on('message', function(msg) {
		if(msg.session_id){
			console.log(msg.session_id + " connected");
		}
		else{
			changeRobi();
			var appendum = '<dd> ich denke '+ msg.answer + ' | war diese antwort hilfreich? : <button onClick=sendEvaluation("'+msg.id.toString()+'","true")> Ja</button><button onClick=sendEvaluation("'+msg.id.toString()+'","false")>Nein</button></dd>';
			$("#messages").append(appendum);
			console.log(appendum);
		}
	});
	//sende Nachricht und resette danach fenster von myMessage
	$('#sendbutton').on('click', function() {
		var message = {
			"text" : $('#myMessage').val(),
			"type" : "question"
		};
		console.log(typeof message);
		console.log(message);
		if(message){
			socket.send(message);
			//$("#messages").append('<dt>'+message.text+'</dt>');
			$('#myMessage').val('');
			console.log("Sent " + message);
		}
		else{
			console.log("bitte gib doch eine nachricht ein")
		}
	});
});
</script>


 <img id="robi" src="/static/robi.jpg" alt="Robi" width="500" height=auto> 
 <nobr></nobr>
 
 <div id="sprechblase">
   <dl widht=300px id="messages">
   </dl>

   <textarea id="myMessage" rows="4" cols="20"> </textarea>
   <button id="sendbutton">Send</button>
 </div>

 <div id="sprechblase:before"> 
 </div>

 <div id="sprechblase:after">
 </div>

</body>
</html>